---
ms.date: 2017-06-05
keywords: PowerShell cmdlet'i
title: WinRMSecurity
ms.openlocfilehash: 0522844fded847a3fd45c1b3890a141357edb2b2
ms.sourcegitcommit: 99227f62dcf827354770eb2c3e95c5cf6a3118b4
ms.translationtype: MT
ms.contentlocale: tr-TR
ms.lasthandoff: 03/15/2018
---
# <a name="powershell-remoting-security-considerations"></a><span data-ttu-id="0bf6c-103">PowerShell uzaktan iletişim güvenlik konuları</span><span class="sxs-lookup"><span data-stu-id="0bf6c-103">PowerShell Remoting Security Considerations</span></span>

<span data-ttu-id="0bf6c-104">PowerShell uzaktan iletişimi, Windows sistemleri yönetmek için önerilen yoldur.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-104">PowerShell Remoting is the recommended way to manage Windows systems.</span></span> <span data-ttu-id="0bf6c-105">PowerShell uzaktan iletişimi, Windows Server 2012 R2'de varsayılan olarak etkindir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-105">PowerShell Remoting is enabled by default in Windows Server 2012 R2.</span></span> <span data-ttu-id="0bf6c-106">Bu belge PowerShell uzaktan iletişimini kullanırken, güvenlik sorunlarının, öneriler ve en iyi yöntemler ele alınmaktadır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-106">This document covers security concerns, recommendations, and best practices when using PowerShell Remoting.</span></span>

## <a name="what-is-powershell-remoting"></a><span data-ttu-id="0bf6c-107">PowerShell uzaktan iletişimi nedir?</span><span class="sxs-lookup"><span data-stu-id="0bf6c-107">What is PowerShell Remoting?</span></span>

<span data-ttu-id="0bf6c-108">PowerShell uzaktan iletişimi kullandığından [Windows Uzaktan Yönetim (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), Microsoft uyarlamasını olduğu [Yönetim (WS-Management) için Web Hizmetleri](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) kullanıcıların PowerShell çalıştırmasına izin vermek için protokol komutları uzak bilgisayarlarda.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-108">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426.aspx), which is the Microsoft implementation of the [Web Services for Management (WS-Management)](http://www.dmtf.org/sites/default/files/standards/documents/DSP0226_1.2.0.pdf) protocol, to allow users to run PowerShell commands on remote computers.</span></span> <span data-ttu-id="0bf6c-109">PowerShell uzaktan iletişim sırasında kullanma hakkında daha fazla bilgi bulabilirsiniz [çalıştıran uzak komutları](https://technet.microsoft.com/library/dd819505.aspx).</span><span class="sxs-lookup"><span data-stu-id="0bf6c-109">You can find more information about using PowerShell Remoting at [Running Remote Commands](https://technet.microsoft.com/library/dd819505.aspx).</span></span>

<span data-ttu-id="0bf6c-110">PowerShell uzaktan iletişimini kullanma ile aynı değil **ComputerName** çalıştırmak için temel protokolü olarak uzak yordam çağrısı (RPC) kullanan bir uzak bilgisayarda bir cmdlet parametresi.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-110">PowerShell Remoting is not the same as using the **ComputerName** parameter of a cmdlet to run it on a remote computer, which uses Remote Procedure Call (RPC) as its underlying protocol.</span></span>

## <a name="powershell-remoting-default-settings"></a><span data-ttu-id="0bf6c-111">PowerShell uzaktan iletişim varsayılan ayarları</span><span class="sxs-lookup"><span data-stu-id="0bf6c-111">PowerShell Remoting default settings</span></span>

<span data-ttu-id="0bf6c-112">PowerShell uzaktan iletişimi (ve WinRM) aşağıdaki bağlantı noktalarını dinlemek:</span><span class="sxs-lookup"><span data-stu-id="0bf6c-112">PowerShell Remoting (and WinRM) listen on the following ports:</span></span>

- <span data-ttu-id="0bf6c-113">HTTP: 5985</span><span class="sxs-lookup"><span data-stu-id="0bf6c-113">HTTP: 5985</span></span>
- <span data-ttu-id="0bf6c-114">HTTPS: 5986</span><span class="sxs-lookup"><span data-stu-id="0bf6c-114">HTTPS: 5986</span></span>

<span data-ttu-id="0bf6c-115">Varsayılan olarak, PowerShell uzaktan iletişim bağlantıları yalnızca Administrators grubunun üyeleri sağlar.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-115">By default, PowerShell Remoting only allows connections from members of the Administrators group.</span></span> <span data-ttu-id="0bf6c-116">Oturumlar, böylece tüm işletim sistemi erişim denetimleri bireysel kullanıcılara uygulanan ve grupları bunları PowerShell uzaktan iletişimi bağlıyken uygulanmaya devam kullanıcının bağlamında başlatılır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-116">Sessions are launched under the user's context, so all operating system access controls applied to individual users and groups continue to apply to them while connected over PowerShell Remoting.</span></span>

<span data-ttu-id="0bf6c-117">Özel ağlarda PowerShell uzaktan iletişim için varsayılan Windows Güvenlik duvarı kuralı tüm bağlantıları kabul eder.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-117">On private networks, the default Windows Firewall rule for PowerShell Remoting accepts all connections.</span></span> <span data-ttu-id="0bf6c-118">Genel ağlarda, varsayılan Windows Güvenlik duvarı kuralı aynı alt ağda yalnızca gelen PowerShell uzaktan iletişim bağlantıları sağlar.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-118">On public networks, the default Windows Firewall rule allows PowerShell Remoting connections only from within the same subnet.</span></span> <span data-ttu-id="0bf6c-119">Ortak ağ üzerindeki tüm bağlantılar için PowerShell uzaktan iletişimi'ni açın, kural açıkça değiştirmeniz gerekir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-119">You have to explicitly change that rule to open PowerShell Remoting to all connections on a public network.</span></span>

><span data-ttu-id="0bf6c-120">**Uyarı:** ortak ağlara için güvenlik duvarı kuralı bilgisayarı dış bağlantı kötü amaçlı saldırılara karşı korumak için tasarlanmıştır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-120">**Warning:** The firewall rule for public networks is meant to protect the computer from potentially malicious external connection attempts.</span></span> <span data-ttu-id="0bf6c-121">Bu kural kaldırırken dikkatli olun.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-121">Use caution when removing this rule.</span></span>

## <a name="process-isolation"></a><span data-ttu-id="0bf6c-122">İşlem yalıtımı</span><span class="sxs-lookup"><span data-stu-id="0bf6c-122">Process isolation</span></span>

<span data-ttu-id="0bf6c-123">PowerShell uzaktan iletişimi kullandığından [Windows Uzaktan Yönetim (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) bilgisayarlar arasındaki iletişim.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-123">PowerShell Remoting uses [Windows Remote Management (WinRM)](https://msdn.microsoft.com/library/windows/desktop/aa384426) for communication between computers.</span></span> <span data-ttu-id="0bf6c-124">WinRM Network Service hesabının altında bir hizmet olarak çalışır ve ana bilgisayar PowerShell örnekleri için kullanıcı hesapları olarak çalışan yalıtılmış işlemler olarak çoğaltılır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-124">WinRM runs as a service under the Network Service account, and spawns isolated processes running as user accounts to host PowerShell instances.</span></span> <span data-ttu-id="0bf6c-125">Bir kullanıcı olarak çalışan PowerShell örneği PowerShell örneği başka bir kullanıcı olarak çalışan bir işlemi hiçbir erişebilir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-125">An instance of PowerShell running as one user has no access to a process running an instance of PowerShell as another user.</span></span>

## <a name="event-logs-generated-by-powershell-remoting"></a><span data-ttu-id="0bf6c-126">PowerShell uzaktan iletişimi tarafından oluşturulan olay günlükleri</span><span class="sxs-lookup"><span data-stu-id="0bf6c-126">Event logs generated by PowerShell Remoting</span></span>

<span data-ttu-id="0bf6c-127">FireEye olay günlüklerini ve PowerShell uzaktan iletişim oturumları, adresinde tarafından oluşturulan diğer güvenlik kanıt iyi özetini sağlamıştır</span><span class="sxs-lookup"><span data-stu-id="0bf6c-127">FireEye has provided a good summary of the event logs and other security evidence generated by PowerShell Remoting sessions, available at</span></span>  
<span data-ttu-id="0bf6c-128">[Saldırılarının PowerShell araştırılması](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span><span class="sxs-lookup"><span data-stu-id="0bf6c-128">[Investigating PowerShell Attacks](https://www.fireeye.com/content/dam/fireeye-www/global/en/solutions/pdfs/wp-lazanciyan-investigating-powershell-attacks.pdf).</span></span>

## <a name="encryption-and-transport-protocols"></a><span data-ttu-id="0bf6c-129">Şifreleme ve aktarım protokolleri</span><span class="sxs-lookup"><span data-stu-id="0bf6c-129">Encryption and transport protocols</span></span>

<span data-ttu-id="0bf6c-130">PowerShell uzaktan iletişim bağlantı iki perspektiften güvenlik düşünmek faydalıdır: ilk kimlik doğrulaması ve devam eden iletişimleri.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-130">It is helpful to consider the security of a PowerShell Remoting connection from two perspectives: initial authentication, and ongoing communication.</span></span> 

<span data-ttu-id="0bf6c-131">Kullanılan Aktarım Protokolü bağımsız olarak (HTTP veya HTTPS), PowerShell uzaktan iletişim ilk kimlik doğrulamasından sonra tüm iletişimi her zaman bir oturum başına AES 256 simetrik anahtarla şifreler.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-131">Regardless of the transport protocol used (HTTP or HTTPS), PowerShell Remoting always encrypts all communication after initial authentication with a per-session AES-256 symmetric key.</span></span>
    
### <a name="initial-authentication"></a><span data-ttu-id="0bf6c-132">İlk kimlik doğrulaması</span><span class="sxs-lookup"><span data-stu-id="0bf6c-132">Initial authentication</span></span>

<span data-ttu-id="0bf6c-133">Kimlik doğrulama - sunucu ve ideal - istemci sunucuya istemcinin kimliğini doğrular.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-133">Authentication confirms the identity of the client to the server - and ideally - the server to the client.</span></span>
    
<span data-ttu-id="0bf6c-134">Bir istemci bilgisayar adını kullanarak bir etki alanı sunucusuna bağlandığında (örn: server01, veya server01.contoso.com), varsayılan kimlik doğrulama protokolüdür [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span><span class="sxs-lookup"><span data-stu-id="0bf6c-134">When a client connects to a domain server using its computer name (i.e.: server01, or server01.contoso.com), the default authentication protocol is [Kerberos](https://msdn.microsoft.com/library/windows/desktop/aa378747.aspx).</span></span>
<span data-ttu-id="0bf6c-135">Kerberos yeniden kullanılabilir kimlik bilgisi herhangi bir tür göndermeden kullanıcı kimliği ve sunucu kimliğini garanti eder.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-135">Kerberos guarantees both the user identity and server identity without sending any sort of reusable credential.</span></span>

<span data-ttu-id="0bf6c-136">İstemci IP adresini kullanarak bir etki alanı sunucusuna bağlanarak veya bir çalışma grubu sunucusuna bağlanır, Kerberos kimlik doğrulaması mümkün değil.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-136">When a client connects to a domain server using its IP address, or connects to a workgroup server, Kerberos authentication is not possible.</span></span> <span data-ttu-id="0bf6c-137">PowerShell uzaktan iletişimi dayanan bu durumda, [NTLM kimlik doğrulama protokolü](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span><span class="sxs-lookup"><span data-stu-id="0bf6c-137">In that case, PowerShell Remoting relies on the [NTLM authentication protocol](https://msdn.microsoft.com/library/windows/desktop/aa378749.aspx).</span></span> <span data-ttu-id="0bf6c-138">NTLM kimlik doğrulama protokolü, herhangi bir tür delegable kimlik bilgisi göndermeden kullanıcı kimliğini garanti eder.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-138">The NTLM authentication protocol guarantees the user identity without sending any sort of delegable credential.</span></span> <span data-ttu-id="0bf6c-139">Kullanıcı kimliğini kanıtlamak için NTLM protokolü istemci ve sunucu bir oturum anahtarı kullanıcının parolayı hiç parola değişimi olmadan işlem gerektirir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-139">To prove user identity, the NTLM protocol requires that both the client and server compute a session key from the user's password without ever exchanging the password itself.</span></span> <span data-ttu-id="0bf6c-140">Kullanıcının parolayı biliyor ve sunucu için oturum anahtarı hesaplar etki alanı denetleyicisi ile iletişim kurar şekilde sunucunun kullanıcı parolasının genellikle bilmez.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-140">The server typically does not know the user's password, so it communicates with the domain controller, which does know the user's password and calculates the session key for the server.</span></span> 
      
<span data-ttu-id="0bf6c-141">NTLM protokolü ancak, sunucu kimliğini garanti etmez.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-141">The NTLM protocol does not, however, guarantee server identity.</span></span> <span data-ttu-id="0bf6c-142">Protokollerle kimlik doğrulaması için NTLM kullanan tüm gibi bir etki alanına katılmış bilgisayarın makine hesabına erişim izni olan bir saldırgan etki alanı denetleyicisi bir NTLM oturum anahtarı işlem ve böylece sunucu özelliklerini çağıramadı.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-142">As with all protocols that use NTLM for authentication, an attacker with access to a domain-joined computer's machine account could invoke the domain controller to compute an NTLM session-key and thereby impersonate the server.</span></span>

<span data-ttu-id="0bf6c-143">NTLM tabanlı kimlik doğrulaması varsayılan olarak devre dışıdır, ancak hedef sunucuda yapılandırma ya da SSL veya istemcide WinRM TrustedHosts ayarını yapılandırarak izin verilir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-143">NTLM-based authentication is disabled by default, but may be permitted by either configuring SSL on the target server, or by configuring the WinRM TrustedHosts setting on the client.</span></span>
    
#### <a name="using-ssl-certificates-to-validate-server-identity-during-ntlm-based-connections"></a><span data-ttu-id="0bf6c-144">NTLM tabanlı bağlantılarını sırasında sunucu kimliğini doğrulamak için SSL sertifikalarını kullanma</span><span class="sxs-lookup"><span data-stu-id="0bf6c-144">Using SSL certificates to validate server identity during NTLM-based connections</span></span>

<span data-ttu-id="0bf6c-145">NTLM kimlik doğrulama protokolü (yalnızca zaten, parolanızı bilir) hedef sunucunun kimliğini garanti edemez olduğundan, hedef sunucular PowerShell uzaktan iletişim için SSL kullanacak şekilde yapılandırabilirsiniz.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-145">Since the NTLM authentication protocol cannot ensure the identity of the target server (only that it already knows your password), you can configure target servers to use SSL for PowerShell Remoting.</span></span> <span data-ttu-id="0bf6c-146">(Ayrıca istemcinin güvendiği bir sertifika yetkilisi tarafından verilen değilse) hedef sunucuya bir SSL sertifikası atama kullanıcı kimliği ve sunucu kimliğini garanti eder, NTLM tabanlı kimlik doğrulamasını etkinleştirir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-146">Assigning a SSL certificate to the target server (if issued by a Certificate Authority that the client also trusts) enables NTLM-based authentication that guarantees both the user identity and server identity.</span></span>
    
#### <a name="ignoring-ntlm-based-server-identity-errors"></a><span data-ttu-id="0bf6c-147">NTLM tabanlı sunucu kimlik hataları yoksayma</span><span class="sxs-lookup"><span data-stu-id="0bf6c-147">Ignoring NTLM-based server identity errors</span></span>
      
<span data-ttu-id="0bf6c-148">NTLM bağlantıları için bir sunucuya bir SSL sertifikası dağıtma uyuşmazlığa ise, WinRM ile sunucu ekleyerek elde edilen kimlik hataları gözardı **TrustedHosts** listesi.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-148">If deploying a SSL certificate to a server for NTLM connections is infeasible, you may suppress the resulting identity errors by adding the server to the WinRM **TrustedHosts** list.</span></span> <span data-ttu-id="0bf6c-149">Lütfen bir sunucu adı TrustedHosts listesine ekleme deyimi ana bilgisayarlarının kendilerini güvenilirliği hakkında herhangi bir biçimde düşünülmemelidir olduğunu not - NTLM kimlik doğrulama protokolü ana bilgisayara aslında bağlanan garanti edemez gibi olduğunuz bağlanmak planlayan.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-149">Please note that adding a server name to the TrustedHosts list should not be considered as any form of statement of the trustworthiness of the hosts themselves - as the NTLM authentication protocol cannot guarantee that you are in fact connecting to the host you are intending to connect to.</span></span>
<span data-ttu-id="0bf6c-150">Bunun yerine, sunucunun kimliğini doğrulayamadı tarafından oluşturulan hata gizlemek istediğiniz ana bilgisayarların listesini TrustedHosts ayarı göz önünde bulundurmalısınız.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-150">Instead, you should consider the TrustedHosts setting to be the list of hosts for which you wish to suppress the error generated by being unable to verify the server's identity.</span></span>
    
    
### <a name="ongoing-communication"></a><span data-ttu-id="0bf6c-151">Devam eden iletişimleri</span><span class="sxs-lookup"><span data-stu-id="0bf6c-151">Ongoing Communication</span></span>

<span data-ttu-id="0bf6c-152">İlk kimlik doğrulaması tamamlandıktan sonra [PowerShell uzaktan iletişim protokolü](https://msdn.microsoft.com/en-us/library/dd357801.aspx) tüm devam eden iletişimleri oturum başına AES 256 simetrik anahtarla şifreler.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-152">Once initial authentication is complete, the [PowerShell Remoting Protocol](https://msdn.microsoft.com/en-us/library/dd357801.aspx) encrypts all ongoing communication with a per-session AES-256 symmetric key.</span></span>  


## <a name="making-the-second-hop"></a><span data-ttu-id="0bf6c-153">İkinci atlama yapma</span><span class="sxs-lookup"><span data-stu-id="0bf6c-153">Making the second hop</span></span>

<span data-ttu-id="0bf6c-154">Varsayılan olarak, PowerShell uzaktan iletişimi (varsa) Kerberos veya NTLM kimlik doğrulaması için kullanır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-154">By default, PowerShell Remoting uses Kerberos (if available) or NTLM for authentication.</span></span> <span data-ttu-id="0bf6c-155">Bu protokollerin her ikisi de, uzak makineye kimlik bilgileri gönderilmeden kimlik doğrulaması.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-155">Both of these protocols authenticate to the remote machine without sending credentials to it.</span></span>
<span data-ttu-id="0bf6c-156">Bu, kimlik doğrulaması için en güvenli yoldur ancak uzak makineye kullanıcının kimlik bilgilerine sahip olmadığından diğer bilgisayarlar ve hizmetler kullanıcı adınıza erişemez.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-156">This is the most secure way to authenticate, but because the remote machine does not have the user's credentials, it cannot access other computers and services on the user's behalf.</span></span> <span data-ttu-id="0bf6c-157">Bu "ikinci atlama sorun" bilinir.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-157">This is known as the "second hop problem".</span></span>

<span data-ttu-id="0bf6c-158">Bu sorunu önlemek için birkaç yolu vardır.</span><span class="sxs-lookup"><span data-stu-id="0bf6c-158">There are several ways to avoid this problem.</span></span> <span data-ttu-id="0bf6c-159">Bu yöntemler ve açıklamaları uzmanları avantajlarını ve dezavantajlarını her için bkz: [ikinci atlama PowerShell uzaktan iletişimi yapma](PS-remoting-second-hop.md).</span><span class="sxs-lookup"><span data-stu-id="0bf6c-159">For descriptions of these methods, and the pros and cons of each, see [Making the second hop in PowerShell Remoting](PS-remoting-second-hop.md).</span></span>










